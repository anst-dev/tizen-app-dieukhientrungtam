<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gi√°m S√°t ƒêi·ªÉm Ch·∫£y - Nh√† M√°y N∆∞·ªõc</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            padding: 2.5vh 2vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2vh;
            padding-bottom: 1.5vh;
            border-bottom: 3px solid #3b82f6;
        }

        .header h1 {
            font-size: 4.5vh;
            font-weight: 700;
            color: #60a5fa;
            text-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
            margin-bottom: 0.5vh;
        }

        .header .datetime {
            font-size: 2.2vh;
            color: #94a3b8;
            font-weight: 500;
        }

        /* KPI Cards Section */
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5vw;
            margin-bottom: 2.5vh;
        }

        .kpi-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 1.5vh;
            padding: 2.5vh 1.5vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(59, 130, 246, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--card-color);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5);
        }

        .kpi-card .icon {
            font-size: 4vh;
            margin-bottom: 1vh;
        }

        .kpi-card .value {
            font-size: 5.5vh;
            font-weight: 700;
            color: var(--card-color);
            margin-bottom: 0.5vh;
            text-shadow: 0 0 15px var(--card-glow);
        }

        .kpi-card .label {
            font-size: 2vh;
            color: #94a3b8;
            font-weight: 500;
        }

        /* Color Themes */
        .kpi-total {
            --card-color: #64748b;
            --card-glow: rgba(100, 116, 139, 0.3);
        }

        .kpi-processing {
            --card-color: #f59e0b;
            --card-glow: rgba(245, 158, 11, 0.3);
        }

        .kpi-completed {
            --card-color: #10b981;
            --card-glow: rgba(16, 185, 129, 0.3);
        }

        .kpi-monitoring {
            --card-color: #3b82f6;
            --card-glow: rgba(59, 130, 246, 0.3);
        }

        .kpi-locations {
            --card-color: #8b5cf6;
            --card-glow: rgba(139, 92, 246, 0.3);
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2vw;
            margin-bottom: 2.5vh;
            flex: 1;
        }

        .chart-container {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 1.5vh;
            padding: 2vh 1.5vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(10px);
        }

        .chart-container h2 {
            font-size: 2.8vh;
            margin-bottom: 2vh;
            color: #60a5fa;
            text-align: center;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 32vh;
        }

        /* Top 5 Table Section */
        .table-section {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 1.5vh;
            padding: 2vh 1.5vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(239, 68, 68, 0.3);
            backdrop-filter: blur(10px);
        }

        .table-section h2 {
            font-size: 2.8vh;
            margin-bottom: 2vh;
            color: #f87171;
            text-align: center;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(59, 130, 246, 0.2);
            padding: 1.8vh 1vw;
            text-align: left;
            font-size: 2.2vh;
            color: #60a5fa;
            font-weight: 600;
            border-bottom: 2px solid #3b82f6;
        }

        td {
            padding: 1.8vh 1vw;
            font-size: 2vh;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            color: #cbd5e1;
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .status-badge {
            padding: 0.5vh 1.2vw;
            border-radius: 1vh;
            font-size: 1.8vh;
            font-weight: 600;
            display: inline-block;
        }

        .status-processing {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
            border: 1px solid #f59e0b;
        }

        .status-overdue {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid #ef4444;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .days-overdue {
            color: #ef4444;
            font-weight: 700;
        }

        /* Auto refresh indicator */
        .refresh-indicator {
            position: fixed;
            top: 2vh;
            right: 2vw;
            background: rgba(16, 185, 129, 0.2);
            padding: 1vh 1.5vw;
            border-radius: 1vh;
            font-size: 1.8vh;
            color: #10b981;
            border: 1px solid #10b981;
        }

        .refresh-dot {
            width: 1vh;
            height: 1vh;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5vw;
            animation: blink 2s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üåä H·ªÜ TH·ªêNG GI√ÅM S√ÅT ƒêI·ªÇM CH·∫¢Y - NH√Ä M√ÅY N∆Ø·ªöC</h1>
            <div class="datetime" id="datetime"></div>
        </div>

        <!-- Auto Refresh Indicator -->
        <div class="refresh-indicator">
            <span class="refresh-dot"></span>
            <span>T·ª± ƒë·ªông l√†m m·ªõi m·ªói 5 ph√∫t</span>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-section">
            <div class="kpi-card kpi-total">
                <div class="icon">üìä</div>
                <div class="value" id="kpi-total">0</div>
                <div class="label">T·ªïng ƒëi·ªÉm ch·∫£y<br>trong th√°ng</div>
            </div>
            <div class="kpi-card kpi-processing">
                <div class="icon">‚öôÔ∏è</div>
                <div class="value" id="kpi-processing">0</div>
                <div class="label">ƒêang x·ª≠ l√Ω</div>
            </div>
            <div class="kpi-card kpi-completed">
                <div class="icon">‚úÖ</div>
                <div class="value" id="kpi-completed">0</div>
                <div class="label">ƒê√£ x·ª≠ l√Ω</div>
            </div>
            <div class="kpi-card kpi-monitoring">
                <div class="icon">üéß</div>
                <div class="value" id="kpi-monitoring">0</div>
                <div class="label">Nghe d√≤<br>trong th√°ng</div>
            </div>
            <div class="kpi-card kpi-locations">
                <div class="icon">üìç</div>
                <div class="value" id="kpi-locations">0</div>
                <div class="label">V·ªã tr√≠ ƒëang<br>nghe d√≤</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-container">
                <h2>üìà Th·ªëng K√™ T·ªïng Quan</h2>
                <div class="chart-wrapper">
                    <canvas id="overviewChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h2>üìä Ti·∫øn ƒê·ªô X·ª≠ L√Ω</h2>
                <div class="chart-wrapper">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Top 5 Table -->
        <div class="table-section">
            <h2>‚ö†Ô∏è TOP 5 ƒêI·ªÇM CH·∫¢Y CH·ªú X·ª¨ L√ù L√ÇU NH·∫§T</h2>
            <table>
                <thead>
                    <tr>
                        <th style="width: 10%">M√£ ƒêC</th>
                        <th style="width: 25%">V·ªã tr√≠</th>
                        <th style="width: 12%">ƒêi·ªán tho·∫°i</th>
                        <th style="width: 15%">Th·ªùi gian ti·∫øp nh·∫≠n</th>
                        <th style="width: 10%">S·ªë ng√†y</th>
                        <th style="width: 18%">Nh√¢n vi√™n KT</th>
                        <th style="width: 10%">Tr·∫°ng th√°i</th>
                    </tr>
                </thead>
                <tbody id="topTable">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sample Data - Replace with API calls
        const dashboardData = {
            kpis: {
                total: 156,
                processing: 23,
                completed: 118,
                monitoring: 89,
                locations: 15
            },
            top5: [
                {
                    code: 'DC-2024-089',
                    location: '123 ƒê∆∞·ªùng L√™ L·ª£i, P. B·∫øn Th√†nh, Q.1',
                    phone: '0908123456',
                    received: '2024-10-01 08:30',
                    days: 29,
                    technician: 'Nguy·ªÖn VƒÉn An',
                    status: 'overdue'
                },
                {
                    code: 'DC-2024-095',
                    location: '456 ƒê∆∞·ªùng Nguy·ªÖn Hu·ªá, P. B·∫øn Ngh√©, Q.1',
                    phone: '0909234567',
                    received: '2024-10-05 14:20',
                    days: 25,
                    technician: 'Tr·∫ßn Th·ªã B√¨nh',
                    status: 'overdue'
                },
                {
                    code: 'DC-2024-102',
                    location: '789 ƒê∆∞·ªùng Pasteur, P. 6, Q.3',
                    phone: '0912345678',
                    received: '2024-10-10 09:15',
                    days: 20,
                    technician: 'L√™ VƒÉn C∆∞·ªùng',
                    status: 'overdue'
                },
                {
                    code: 'DC-2024-118',
                    location: '321 ƒê∆∞·ªùng ƒêi·ªán Bi√™n Ph·ªß, P. ƒêakao, Q.1',
                    phone: '0913456789',
                    received: '2024-10-15 16:45',
                    days: 15,
                    technician: 'Ph·∫°m Th·ªã Dung',
                    status: 'overdue'
                },
                {
                    code: 'DC-2024-127',
                    location: '654 ƒê∆∞·ªùng C√°ch M·∫°ng Th√°ng 8, P.7, Q.3',
                    phone: '0914567890',
                    received: '2024-10-20 11:00',
                    days: 10,
                    technician: 'Ho√†ng VƒÉn Em',
                    status: 'processing'
                }
            ]
        };

        // Update DateTime
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('vi-VN', options);
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Update KPIs
        function updateKPIs(data) {
            document.getElementById('kpi-total').textContent = data.total;
            document.getElementById('kpi-processing').textContent = data.processing;
            document.getElementById('kpi-completed').textContent = data.completed;
            document.getElementById('kpi-monitoring').textContent = data.monitoring;
            document.getElementById('kpi-locations').textContent = data.locations;
        }

        // Create Overview Chart
        function createOverviewChart(data) {
            const ctx = document.getElementById('overviewChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['T·ªïng s·ªë', 'ƒêang x·ª≠ l√Ω', 'ƒê√£ x·ª≠ l√Ω', 'Nghe d√≤', 'V·ªã tr√≠ nghe d√≤'],
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£ng',
                        data: [data.total, data.processing, data.completed, data.monitoring, data.locations],
                        backgroundColor: [
                            'rgba(100, 116, 139, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ],
                        borderColor: [
                            '#64748b',
                            '#f59e0b',
                            '#10b981',
                            '#3b82f6',
                            '#8b5cf6'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 16 }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 16 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Create Progress Chart
        function createProgressChart(data) {
            const ctx = document.getElementById('progressChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ti·∫øn ƒë·ªô x·ª≠ l√Ω th√°ng n√†y'],
                    datasets: [
                        {
                            label: 'ƒê√£ x·ª≠ l√Ω',
                            data: [data.completed],
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: '#10b981',
                            borderWidth: 2
                        },
                        {
                            label: 'ƒêang x·ª≠ l√Ω',
                            data: [data.processing],
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: '#f59e0b',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#94a3b8',
                                font: { size: 18 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 16 }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            stacked: true,
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 16 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Update Top 5 Table
        function updateTop5Table(items) {
            const tbody = document.getElementById('topTable');
            tbody.innerHTML = items.map(item => `
                <tr>
                    <td><strong>${item.code}</strong></td>
                    <td>${item.location}</td>
                    <td>${item.phone}</td>
                    <td>${item.received}</td>
                    <td class="days-overdue">${item.days} ng√†y</td>
                    <td>${item.technician}</td>
                    <td>
                        <span class="status-badge ${item.status === 'overdue' ? 'status-overdue' : 'status-processing'}">
                            ${item.status === 'overdue' ? 'üî¥ Qu√° h·∫°n' : '‚öôÔ∏è ƒêang x·ª≠ l√Ω'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // Initialize Dashboard
        function initDashboard() {
            updateKPIs(dashboardData.kpis);
            createOverviewChart(dashboardData.kpis);
            createProgressChart(dashboardData.kpis);
            updateTop5Table(dashboardData.top5);
        }

        // Refresh Data Function (Call API here)
        function refreshData() {
            console.log('Refreshing data...');
            // TODO: Replace with actual API call
            // fetch('/api/dashboard-data')
            //     .then(response => response.json())
            //     .then(data => {
            //         updateKPIs(data.kpis);
            //         updateTop5Table(data.top5);
            //     });
        }

        // Initialize
        initDashboard();

        // Auto refresh every 5 minutes
        setInterval(refreshData, 5 * 60 * 1000);

        // ===== NAVIGATION FOR MULTIPLE INPUT DEVICES =====
        // Support for: Tizen TV Remote, Keyboard, Mouse

        const SCROLL_AMOUNT = 200; // pixels to scroll per arrow key press
        const PAGE_SCROLL_AMOUNT = window.innerHeight * 0.8; // 80% of viewport height
        const ZOOM_KEYS = ['AudioVolumeUp', 'AudioVolumeDown', 'VolumeUp', 'VolumeDown'];
        const ZOOM_KEY_CODES = [175, 174, 447, 448];

        // ===== KEYBOARD NAVIGATION =====
        document.addEventListener('keydown', function (e) {
            // Prevent default for navigation keys
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Escape',
                'PageUp', 'PageDown', 'Home', 'End', ' '].includes(e.key) ||
                e.keyCode === 10009 || // Tizen Back key
                ZOOM_KEYS.includes(e.key) ||
                ZOOM_KEY_CODES.includes(e.keyCode)) {
                e.preventDefault();
            }

            // Handle different keys
            switch (e.key) {
                case 'ArrowUp':
                    // Scroll up
                    window.scrollBy({
                        top: -SCROLL_AMOUNT,
                        behavior: 'smooth'
                    });
                    break;

                case 'ArrowDown':
                    // Scroll down
                    window.scrollBy({
                        top: SCROLL_AMOUNT,
                        behavior: 'smooth'
                    });
                    break;

                case 'ArrowLeft':
                    // Scroll left (if needed)
                    window.scrollBy({
                        left: -SCROLL_AMOUNT,
                        behavior: 'smooth'
                    });
                    break;

                case 'ArrowRight':
                    // Scroll right (if needed)
                    window.scrollBy({
                        left: SCROLL_AMOUNT,
                        behavior: 'smooth'
                    });
                    break;

                case 'PageUp':
                    // Scroll up one page
                    window.scrollBy({
                        top: -PAGE_SCROLL_AMOUNT,
                        behavior: 'smooth'
                    });
                    break;

                case 'PageDown':
                case ' ': // Space bar
                    // Scroll down one page
                    window.scrollBy({
                        top: PAGE_SCROLL_AMOUNT,
                        behavior: 'smooth'
                    });
                    break;

                case 'Home':
                    // Scroll to top
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                    break;

                case 'End':
                    // Scroll to bottom
                    window.scrollTo({
                        top: document.body.scrollHeight,
                        behavior: 'smooth'
                    });
                    break;

                case 'Escape':
                    // Back to dashboard - communicate with parent window
                    if (window.parent && window.parent !== window) {
                        // This is inside iframe, send message to parent
                        window.parent.postMessage({ action: 'navigateBack' }, '*');
                    }
                    break;
            }

            // Handle Tizen Back key (keyCode 10009)
            if (e.keyCode === 10009) {
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({ action: 'navigateBack' }, '*');
                }
            }
        });

        // ===== MOUSE NAVIGATION =====
        // Enable smooth scrolling via mouse wheel
        let isScrolling = false;
        let scrollTimeout;

        document.addEventListener('wheel', function (e) {
            // Prevent default browser scroll behavior for smoother control
            e.preventDefault();

            // Clear previous timeout
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }

            // Calculate scroll amount based on wheel delta
            const scrollAmount = e.deltaY > 0 ? SCROLL_AMOUNT : -SCROLL_AMOUNT;

            // Perform smooth scroll
            window.scrollBy({
                top: scrollAmount,
                behavior: 'smooth'
            });

            // Set scrolling flag
            isScrolling = true;

            // Reset scrolling flag after a delay
            scrollTimeout = setTimeout(() => {
                isScrolling = false;
            }, 150);
        }, { passive: false });

        // Enable click-and-drag scrolling
        let isDragging = false;
        let startY = 0;
        let startScrollTop = 0;

        document.addEventListener('mousedown', function (e) {
            isDragging = true;
            startY = e.pageY;
            startScrollTop = window.pageYOffset;
            document.body.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;

            const deltaY = startY - e.pageY;
            window.scrollTo({
                top: startScrollTop + deltaY,
                behavior: 'auto' // instant scroll for dragging
            });
        });

        document.addEventListener('mouseup', function () {
            isDragging = false;
            document.body.style.cursor = 'default';
        });

        document.addEventListener('mouseleave', function () {
            isDragging = false;
            document.body.style.cursor = 'default';
        });

        // ===== TIZEN TV HARDWARE KEY REGISTRATION =====
        // Register Tizen hardware keys if available
        if (window.tizen && window.tizen.tvinputdevice) {
            try {
                const keys = ['VolumeUp', 'VolumeDown'];
                keys.forEach(key => {
                    try {
                        window.tizen.tvinputdevice.registerKey(key);
                    } catch (err) {
                        console.log('Cannot register key:', key);
                    }
                });
            } catch (err) {
                console.log('Tizen TV Input Device not available');
            }
        }


    </script>
</body>

</html>